<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>単語表示</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 30px;
      user-select: none;
      margin: 0;
    }

    #text {
      font-size: 2rem;
      margin: 40px 0;
      min-height: 3em;
    }

    input[type="number"], button {
      font-size: 1.2rem;
      padding: 8px;
      margin: 5px;
    }

    #buttons {
      margin-top: 20px;
    }
	
	@media screen and (max-width: 600px) {
	  body {
		padding: 20px;
	  }

	  #text {
		font-size: 1.5rem;
		margin: 30px 0;
		min-height: 2.5em;
	  }

	  input[type="number"], button {
		font-size: 1rem;
		padding: 6px;
		margin: 4px;
	  }
	}
	
	/* Prev, Next ボタン用のクラス */
	.nav-button {
	  font-size: 2rem; /* 大きめ */
	  padding: 12px 24px;
	  margin: 10px;
	}

	/* シャッフルボタンの位置調整 */
	#shuffle-area {
	  margin-top: 20px;
	}

	#shuffle-area button {
	  font-size: 1.2rem;
	  padding: 8px 16px;
	}
	
	#shuffle-area input {
	  font-size: 1rem;
	  padding: 6px;
	  margin: 4px;
	  width: 100px;
	}

	
  </style>
</head>
<body>
  <h1>単語リスト</h1>

  <div>
    番号指定：
    <input type="number" id="jumpNumber" min="1">
    <button onclick="jumpToNumber(event)">ジャンプ</button>
  </div>

  <div id="text">読み込み中...</div>

	<div id="buttons">
	  <button class="nav-button" onclick="prev()">Prev</button>
	  <button class="nav-button" onclick="next()">Next</button>
	</div>

	<!-- シャッフルボタンを下に分けて配置 -->
	<div id="shuffle-area">
	  <button onclick="shuffleEntries()">シャッフル</button>
	</div>
	
	<div id="shuffle-area">
	  <div>
		シャッフル範囲：
		<input type="number" id="shuffleStart" placeholder="開始番号" min="1">
		～ 
		<input type="number" id="shuffleEnd" placeholder="終了番号" min="1">
	  </div>
	  <button onclick="shuffleEntries()">シャッフル</button>
	</div>


  <script>
    let entries = [];
    let index = 0;
    let subIndex = 0; // 0: 単語, 1: 意味

    async function loadTexts() {
      try {
        const res = await fetch('texts.txt');
        const content = await res.text();

        const lines = content
          .split('\n')
          .map(line => line.trim())
          .filter(line => line !== '');

        entries = [];

        for (let i = 0; i < lines.length - 1; i += 2) {
          const parts = lines[i].split(/\s+/);
          const num = parseInt(parts[0]);
          const word = parts[1];
          const meaning = lines[i + 1];

          if (!num || !word || !meaning) continue;

          entries.push({ number: num, word: word, meaning: meaning });
        }

        if (entries.length === 0) {
          document.getElementById("text").textContent = "データが読み込めませんでした";
          return;
        }

        index = 0;
        subIndex = 0;
        showText();
      } catch (err) {
        console.error("読み込みエラー:", err);
        document.getElementById("text").textContent = "読み込み中にエラーが発生しました";
      }
    }

    function showText() {
      const entry = entries[index];
      const display = subIndex === 0
        ? `${entry.number}. ${entry.word}`
        : entry.meaning;

      document.getElementById("text").textContent = display;
    }

    function next() {
      if (entries.length === 0) return;

      subIndex++;
      if (subIndex > 1) {
        subIndex = 0;
        index = (index + 1) % entries.length;
      }
      showText();
    }

    function prev() {
      if (entries.length === 0) return;

      subIndex--;
      if (subIndex < 0) {
        index = (index - 1 + entries.length) % entries.length;
        subIndex = 1;
      }
      showText();
    }
	
	function shuffleEntries() {
	  if (entries.length === 0) return;

	  const startNum = parseInt(document.getElementById("shuffleStart").value);
	  const endNum = parseInt(document.getElementById("shuffleEnd").value);

	  if (isNaN(startNum) || isNaN(endNum)) {
		alert("開始番号と終了番号を入力してください");
		return;
	  }

	  if (startNum >= endNum) {
		alert("開始番号は終了番号より小さくしてください");
		return;
	  }

	  // 指定範囲のindexを取得
	  const startIndex = entries.findIndex(e => e.number === startNum);
	  const endIndex = entries.findIndex(e => e.number === endNum);

	  if (startIndex === -1 || endIndex === -1) {
		alert("指定した番号が見つかりませんでした");
		return;
	  }

	  // 指定範囲だけをシャッフル（Fisher-Yates）
	  const range = entries.slice(startIndex, endIndex + 1);
	  for (let i = range.length - 1; i > 0; i--) {
		const j = Math.floor(Math.random() * (i + 1));
		[range[i], range[j]] = [range[j], range[i]];
	  }

	  // 結果を entries に反映
	  entries.splice(startIndex, range.length, ...range);

	  index = startIndex;
	  subIndex = 0;
	  showText();
	}



    function jumpToNumber(event) {
      event.stopPropagation();
      const num = parseInt(document.getElementById("jumpNumber").value);
      const foundIndex = entries.findIndex(e => e.number === num);
      if (foundIndex !== -1) {
        index = foundIndex;
        subIndex = 0;
        showText();
      } else {
        alert("その番号は見つかりませんでした");
      }
    }

    loadTexts();
  </script>
</body>
</html>
