<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>単語表示</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 30px;
      user-select: none;
      margin: 0;
    }

    #text {
      font-size: 2rem;
      margin-top: 50px;
      padding: 20px;
    }

    input[type="number"], button {
      font-size: 1.2rem;
      padding: 8px;
      margin: 10px 5px;
    }
  </style>
</head>
<body ontouchstart="" onclick="handleBodyClick(event)">
  <h1>単語リスト</h1>
  <div id="control" onclick="event.stopPropagation();">
    番号指定：
    <input type="number" id="jumpNumber" min="1">
    <button onclick="jumpToNumber(event)">ジャンプ</button>
  </div>

  <div id="text">読み込み中...</div>

  <script>
    let entries = []; // [{number: 1, word: 'follow', meaning: '～'}]
    let index = 0;
    let subIndex = 0; // 0: 番号＋英語, 1: 意味

    async function loadTexts() {
      try {
        const res = await fetch('texts.txt');
        const content = await res.text();  // ← これ絶対必要！！
    
        entries = content
          .split('\n')
          .map(line => line.trim())
          .filter(line => line !== '')
          .map(line => {
            const parts = line.split(/\s+/);
            const num = parseInt(parts[0]);
            const word = parts[1];
            const meaning = parts.slice(2).join(' ');
            if (!num || !word || !meaning) {
              console.warn("無効な行：", line);
              return null;
            }
            return { number: num, word: word, meaning: meaning };
          })
          .filter(entry => entry !== null);
    
        if (entries.length === 0) {
          document.getElementById("text").textContent = "データが読み込めませんでした";
          return;
        }
    
        index = 0;
        subIndex = 0;
        showText();
      } catch (err) {
        console.error("読み込みエラー:", err);
        document.getElementById("text").textContent = "読み込み中にエラーが発生しました";
      }
    }


    function showText() {
      const entry = entries[index];
      const textBox = document.getElementById("text");

      if (subIndex === 0) {
        textBox.textContent = `${entry.number}. ${entry.word}`;
      } else if (subIndex === 1) {
        textBox.textContent = entry.meaning;
      }
    }

    function changeText() {
      if (entries.length === 0) return;

      subIndex++;
      if (subIndex > 1) {
        subIndex = 0;
        index = (index + 1) % entries.length;
      }
      showText();
    }

    function jumpToNumber(event) {
      event.stopPropagation();
      const num = parseInt(document.getElementById("jumpNumber").value);
      const foundIndex = entries.findIndex(e => e.number === num);
      if (foundIndex !== -1) {
        index = foundIndex;
        subIndex = 0;
        showText();
      } else {
        alert("その番号は見つかりませんでした");
      }
    }

    function handleBodyClick(event) {
      // 入力欄やボタンのクリックは除外
      if (event.target.closest('#control')) return;
      changeText();
    }

    loadTexts();
  </script>
</body>
</html>
